---
title: 命令解析配置
date: 2022-03-20 13:02:11
permalink: /developer/doc/step-2
---

接下来你需要为你的插件配置命令解析

``` python
from arclet.alconna import Alconna  # 导入命令解析器
from app.core.command_manager import CommandManager  # 导入命令管理器
······


class Module(Plugin):
    ······
    manager: CommandManager = CommandManager.get_command_instance()  # 获取命令管理器实例

    @manager(Alconna(
        pass
    ))
```

- 命令解析器基础配置详解:

`Alconna` 命令结构类似与 `Linux` 的命令, 由 <前缀> <父命令> <子命令> <可选命令> 组成.

其中 <子命令> 中可嵌套 <可选命令>, 具体请查阅 `Alconna` 官方文档.

- <子命令>: `from arclet.alconna import Subcommand`
- <可选命令>: `from arclet.alconna import Option`
- <参数>: `from arclet.alconna import Args`

假设有命令: `.pip install --upgrade <package>`, 其中 `upgrade` 为可选命令.

``` python
from arclet.alconna import Alconna, Subcommand, Option, Args

Alconna(
    headers=manager.headers,  # 命令前缀(固定写法, 直接使用manager.headers)
    command=entry,  # 父命令, 入口命令(固定写法, 直接使用entry, 与其一致)
    options=[
        Subcommand('install', help_text='安装pip包', args=Args['package': str], options[
            Option('--upgrade', alias='-u', help_text='更新')
        ])
    ],
    help_text='pip管理'
)
```

- help_text: 帮助文本
- alias: 可选命令简写
- Args: ['参数名': 参数类型]

## 配置插件入口方法

接下来你需要写一个命令入口方法, 并接受 Arpamar<解析结果> 和 Alconna<该命令解析器> 参数

``` python
······


class Module(Plugin):
    from arclet.alconna import Alconna, ······, Arpamar
    ······
    async def plugin_name(self, command: Arpamar, alc: Alconna):
        pass
```

然后将上一步生成的Alconna整合至装饰器中, 并放至该入口方法前

``` python
······


class Module(Plugin):
    ······
    @manager(Alconna(
        headers=manager.headers,
        command=entry,
        options=[
            Subcommand('install', help_text='安装pip包', args=Args['package': str], options[
                Option('--upgrade', alias='-u', help_text='更新')
            ])
        ],
        # main_args=Args['xxx': xxx],  # 父参数解析
        help_text='pip管理'
    ))
    async def plugin_name(self, command: Arpamar, alc: Alconna)
        pass
```

至此, 一个插件的基本构造已经完成, 接下来你需要自由完成该插件的功能.


## 说明: Alconna

Alconna 是一个优秀的命令解析器, 它采用类似与 Linux Shell 的命令方式.

- Arpamar基本方法
- 1. Arpamar.subcommands: 获取所有解析出来的子命令参数键值对(包括可选命令), 若你不知道它获取出来的数据结构(你为何不print一下呢?)
- 2. Arpamar.other_args: 获取所有解析出来的可选命令参数键值对.
- 3. Arpamar.main_args: 获取所有解析出来的主参数键值对

::: tip
其它使用方法请查阅 [Alconna 官方文档](https://arcletproject.github.io/docs/alconna/tutorial/)
:::